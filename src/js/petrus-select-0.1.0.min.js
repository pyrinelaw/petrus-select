(function(){var zIndex=1;var defaultOptions={width:NaN,styleName:'blue',title:'请选择',backText:'BACK',$container:null,selected:[],data:{},callbacks:{init:null,titClicked:null,change:null}}var initOptions={spreadStatus:0}var Attrs={initialize:function(){var $container=this.$container,$el=this.$el=$('<div class="petrus-select petrus-'+this.styleName+'-select"></div>');if(this.width)$el.width(this.width);if($container)$container.append($el);this.renderTit();if(this.getCatLen()==0)return;this.renderCat();this.renderSub();if(this.callbacks.init)this.callbacks.init();zIndex++;return true},renderTit:function(){var $titWrap=this.$titWrap;if(!$titWrap){$titWrap=this.$titWrap=$('<div class="petrus-select-tit"></div>');this.$el.append($titWrap);var _this=this;$titWrap.click(function(){_this.titClicked()});if(this.getCatLen()>0){var $arrow=$('<div class="petrus-select-tit-arrow"></div>');$titWrap.append($arrow)}this.$tit=$('<span></span>');$titWrap.append(this.$tit)}this.$tit.html(this.selected[1]||this.selected[0]||this.title)},renderCat:function(){var $catWrap=this.$catWrap;if(!$catWrap){$catWrap=this.$catWrap=$('<div class="petrus-select-list-wrap" ></div>');this.$el.append($catWrap);var _this=this;$catWrap.delegate(".petrus-select-option","click",function(e){var $cat=$(e.target);_this.changeCat(_this.getCatByIdx($cat.index()))});return}$catWrap.css('z-index',zIndex);$catWrap.empty();var data=this.data;for(var k in data){this.create$cat(k)}},renderSub:function(){if(!this.selected||!this.selected[0]||this.selected[0].length==0)return;var $subWrap=this.$subWrap;if(!$subWrap){$subWrap=this.$subWrap=$('<div class="petrus-select-list-wrap"></div>');this.$el.append($subWrap);var _this=this;$subWrap.delegate('.sub','click',function(e){var $sub=$(e.target),idx=$sub.index();_this.changeSub(_this.data[_this.selected[0]][idx-1])});return}$subWrap.css('z-index',zIndex);zIndex++;$subWrap.empty();this.createBack();var data=this.data;for(k in data[this.selected[0]]){this.create$sub(data[this.selected[0]][k])}},reset$cat:function(isLeave){$catWrap=this.$catWrap;$catWrap.removeClass('petrus-select-list-wrap-up');$catWrap.removeClass('petrus-select-list-wrap-down');$catWrap.removeClass('petrus-select-list-wrap-turn-hide');$catWrap.removeClass('petrus-select-list-wrap-turn-show');if(!isLeave)this.$catWrap.empty()},reset$sub:function(isLeave){var $subWrap=this.$subWrap;$subWrap.removeClass('petrus-select-list-wrap-up')$subWrap.removeClass('petrus-select-list-wrap-down');$subWrap.removeClass('petrus-select-list-wrap-move-show');$subWrap.removeClass('petrus-select-list-wrap-move-hide');if(!isLeave)$subWrap.empty()},create$cat:function(cat){var $catWrap=this.$catWrap,$cat=$('<div class="petrus-select-option">'+cat+'</div>');if(this.selected[0]==cat)$cat.addClass('selected');if(this.data[cat]&&this.data[cat].length>0){var $arrow=$('<div class="petrus-select-option-arrow"></div>');$cat.append($arrow)}$catWrap.append($cat)},create$sub:function(sub){var $subWrap=this.$subWrap,$sub=$('<div class="petrus-select-option sub">'+sub+'</div>');if(this.selected[1]==sub)$sub.addClass('selected');$subWrap.append($sub)},createBack:function(){var $back=$('<div class="petrus-select-option back">'+this.backText+'</div>'),$arrow=$('<div class="petrus-select-option-arrow back"></div>');$back.append($arrow);var _this=this;$back.click(function(event){_this.onBack()});this.$subWrap.append($back)},titClicked:function(){if(this.spreadStatus==0&&this.selected.length<2){this.catWrapUp()}else if(this.spreadStatus==1&&this.selected.length<2){this.catWrapDown()}if(this.spreadStatus==0&&this.selected.length==2){this.subWrapUp()}else if(this.spreadStatus==2){this.subWrapDown()}if(this.callbacks.titClicked){this.callbacks.titClicked.call(null,this.selected)}},onBack:function(){this.subWrapHide()},setSpreadStatus:function(status){this.spreadStatus=status},equalCat:function(cat){if((!cat&&!this.selected[0])||(cat&&cat==this.selected[0]))return true;return false},changeCat:function(cat){if(!this.data[cat]||this.data[cat].length==0){if(!this.equalCat(cat)){this.setSelected([cat])}this.catWrapDown()}else if(this.data[cat].length>0){if(!this.equalCat(cat)){this.setSelected([cat])}this.subWrapShow()}},changeSub:function(sub){this.setSelected([this.selected[0],sub]);this.subWrapDown()},setSelected:function(selected){selected=selected||[];if(this.selected.length!=selected.length||this.selected[0]!=this.selected[0]||this.selected[0]!=this.selected[1]){this.selected=selected;this.renderTit();if(this.callbacks.change)this.callbacks.change.call(null,this.selected)}},getCatByIdx:function(idx){var i=0;for(var key in this.data){if(i==idx)return key;i++}return null},getCatLen:function(){var len=0;for(var key in this.data){len++}return len},catWrapUp:function(){this.setSpreadStatus(1);var _this=this;this.renderCat();_this.$catWrap.addClass('petrus-select-list-wrap-up')},catWrapDown:function(){this.setSpreadStatus(0);this.reset$cat(true);this.$catWrap.addClass('petrus-select-list-wrap-down');var _this=this;setTimeout(function(){_this.reset$cat()},300)},subWrapShow:function(){this.setSpreadStatus(2);this.renderSub();this.$catWrap.addClass('petrus-select-list-wrap-turn-hide');var _this=this;setTimeout(function(){_this.reset$cat()},300);this.renderSub();this.$subWrap.addClass('petrus-select-list-wrap-move-show')},subWrapHide:function(){this.setSpreadStatus(1);this.$subWrap.addClass('petrus-select-list-wrap-move-hide');var _this=this;setTimeout(function(){_this.reset$sub()},300);this.renderCat();this.$catWrap.addClass('petrus-select-list-wrap-turn-show')},subWrapUp:function(){this.setSpreadStatus(2);this.renderSub();this.$subWrap.addClass('petrus-select-list-wrap-up')},subWrapDown:function(){this.setSpreadStatus(0);this.reset$sub(true);this.$subWrap.addClass('petrus-select-list-wrap-down');var _this=this;setTimeout(function(){_this.reset$sub()},300)}}var petrus_select=function(settings){settings=settings||{};$.extend(true,this,defaultOptions,initOptions,settings);$.extend(true,this,Attrs);this.initialize();return{selected:this.selected}return this}$.petrus_select=function(settings){return new petrus_select(settings)}$.fn.petrus_select=function(settings){settings=settings||{};settings.$container=$(this);return $.petrus_select(settings)}})()